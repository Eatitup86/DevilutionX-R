version: 1.0.{build}

pull_requests:
  do_not_increment_build_number: true
image: Visual Studio 2022

for:
  -
    cache: '%LOCALAPPDATA%\vcpkg\archives'

    install:
      - if not exist C:\Tools\vcpkg mkdir C:\Tools\vcpkg
      - cd C:\Tools\vcpkg
      - git pull
      - .\bootstrap-vcpkg.bat
      - cd %APPVEYOR_BUILD_FOLDER%

    before_build:
      - cmake -G "Visual Studio 17 2022" -A x64 -DCMAKE_BUILD_TYPE=RelWithDebInfo -DCMAKE_TOOLCHAIN_FILE=c:/tools/vcpkg/scripts/buildsystems/vcpkg.cmake .

    build:
      project: $(APPVEYOR_BUILD_FOLDER)\$(APPVEYOR_PROJECT_NAME).sln
      verbosity: minimal

  -
    before_build:
      - cd %APPVEYOR_BUILD_FOLDER%\Packaging\xbox-one
      - if exist ..\..\build rd /s /q ..\..\build

    build_script:
      - build.bat

    after_build:
      - cd %APPVEYOR_BUILD_FOLDER%

artifacts:
  - path: Debug
    name: devilutionx.exe
  - path: build
    name: devilutionX_*_x64.appx
  - path: build
    name: Microsoft.VCLibs.x64.*.appx
